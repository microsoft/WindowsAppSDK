parameters:
- name: "PublishToMaestro"
  type: boolean
  default: true
- name: "IgnoreFailures"
  type: boolean
  default: true
- name: "TestSampleApps"
  displayName: "Test launch of Sample apps separately in the TestSampleApps Stage"
  type: boolean
  default: false
- name: "TestOnArm64"
  displayName: "Enable running of sample tests on arm64 platform (Default: false)"
  type: boolean
  default: false
- name: "MaestroDependOnTestSamples"
  displayName: "Whether Maestro publishing should depend on successful Sample tests"
  type: boolean
  default: false
stages:
- stage: Publish
  dependsOn:
  - Test_x86
  - Test_x64
  - ${{ if eq(parameters.TestOnArm64, true)}}:
    - Test_arm64
  - StaticValidationTest
  - ${{ if and(eq( parameters.TestSampleApps, true ), eq( parameters.MaestroDependOnTestSamples, true )) }}:
    - TestSampleApps_x64
    - ${{ if eq( parameters.TestOnArm64, true ) }}:
      - TestSampleApps_arm64
  condition: not(failed())
  jobs:
  # Publish
  - job: Publish
    condition: and(or(succeeded(), eq(${{ parameters.IgnoreFailures }}, 'true')), eq('${{ parameters.PublishToMaestro }}', 'true'))
    pool:
      type: windows
      isCustom: true
      name: 'ProjectReunionESPool-2022' # This job is purely for ES, hence this custom pool
    variables:
      WindowsAppSDKPackageVersion: $[ stageDependencies.Pack.NugetPackage.outputs['SetVersion.packageVersion'] ]
    steps:
    - template: AzurePipelinesTemplates/WindowsAppSDK-PublishToMaestro-Steps.yml@WindowsAppSDKConfig
      parameters:
        NuGetArtifactNames:
        - 'TransportPackage'
